import { contentModelCategoryToTagNames } from '@markuplint/ml-spec';
import { createSelector } from '../create-selector.js';
export function contentModelPseudoClass(specs) {
    return (category) => (
    // eslint-disable-next-line @typescript-eslint/prefer-readonly-parameter-types
    el) => {
        category = category.trim().toLowerCase();
        const selectors = contentModelCategoryToTagNames(`#${category}`, specs.def);
        const matched = selectors
            .flatMap(selector => {
            if (selector === '#custom') {
                // @ts-ignore
                if (el.isCustomElement) {
                    return [
                        {
                            specificity: [0, 1, 0],
                            matched: true,
                            nodes: [el],
                            has: [],
                        },
                    ];
                }
                return [
                    {
                        specificity: [0, 1, 0],
                        matched: false,
                    },
                ];
            }
            if (selector === '#text') {
                return [
                    {
                        specificity: [0, 1, 0],
                        matched: false,
                    },
                ];
            }
            return createSelector(selector, specs).search(el);
        })
            .filter((m) => m.matched);
        if (matched.length > 0) {
            return {
                specificity: [0, 1, 0],
                matched: true,
                nodes: matched.flatMap(m => (m.matched ? m.nodes : [])),
                has: matched.flatMap(m => (m.matched ? m.has : [])),
            };
        }
        return {
            specificity: [0, 1, 0],
            matched: false,
        };
    };
}
